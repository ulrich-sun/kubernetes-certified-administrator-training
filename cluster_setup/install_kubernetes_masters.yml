- hosts: masters 
  become: true

  pre_tasks:
  - name: update all packages
    yum:
      name: '*'
      update_only: yes
      update_cache: yes
      state: latest

  - name: Install epel release
    yum:
      name: epel-release
      state: installed
      
  - name: Enable br_netfilter module
    modprobe:
      name: br_netfilter
      state: present
    when: >
      ansible_distribution != 'Debian' 

  - name: ipforward to 1
    sysctl:
      name: net.ipv4.ip_forward
      value: '1'
      sysctl_set: true
      state: present
      reload: true
 
  roles:
    - role: geerlingguy.pip
    - role: geerlingguy.containerd
    - role: geerlingguy.kubernetes
